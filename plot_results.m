% -------------------------------------------------------------------------
% Section: Analysis
% Purpose: Generate performance plots from benchmark results.
% Input:   results.mat (generated by run_experiments.m)
% Output:  Saves plots to 'images/' directory.
% -------------------------------------------------------------------------

function plot_results()
    if ~exist('results.mat', 'file')
        error('results.mat not found. Run run_experiments.m first.');
    end
    
    load('results.mat', 'results');
    
    if ~exist('images', 'dir')
        mkdir('images');
    end
    
    % Extract Data
    files = unique({results.File});
    models = unique({results.Model});
    
    bps_data = zeros(length(files), length(models));
    time_data = zeros(length(files), length(models));
    
    for f = 1:length(files)
        for m = 1:length(models)
            % Find entry
            idx = find(strcmp({results.File}, files{f}) & strcmp({results.Model}, models{m}));
            if ~isempty(idx)
                bps_data(f, m) = results(idx).BPS;
                time_data(f, m) = results(idx).EncTime;
            end
        end
    end
    
    % Plot 1: Compression Performance (BPS)
    figure('Visible', 'off');
    bar(bps_data);
    title('Compression Performance (Bits Per Symbol)');
    xlabel('Dataset');
    ylabel('Bits Per Symbol (Lower is Better)');
    set(gca, 'XTickLabel', files, 'TickLabelInterpreter', 'none');
    legend(models, 'Location', 'bestoutside');
    grid on;
    saveas(gcf, 'images/compression_performance.png');
    fprintf('Saved images/compression_performance.png\n');
    
    % Plot 2: Encoding Time
    figure('Visible', 'off');
    bar(time_data);
    title('Encoding Time (Seconds)');
    xlabel('Dataset');
    ylabel('Time (s) (Lower is Better)');
    set(gca, 'XTickLabel', files, 'TickLabelInterpreter', 'none');
    legend(models, 'Location', 'bestoutside');
    grid on;
    saveas(gcf, 'images/encoding_time.png');
    fprintf('Saved images/encoding_time.png\n');
    
    % Plot 3: Trade-off (Scatter Plot)
    % Average across datasets
    avg_bps = mean(bps_data, 1);
    avg_time = mean(time_data, 1);
    
    figure('Visible', 'off');
    scatter(avg_time, avg_bps, 100, 'filled');
    title('Compression vs. Complexity Trade-off');
    xlabel('Average Encoding Time (s)');
    ylabel('Average Bits Per Symbol');
    grid on;
    
    % Label points
    for m = 1:length(models)
        text(avg_time(m), avg_bps(m), ['  ' models{m}], 'FontSize', 10);
    end
    saveas(gcf, 'images/tradeoff.png');
    fprintf('Saved images/tradeoff.png\n');
    
    % Plot 4: File Size vs Compression Ratio
    figure('Visible', 'off');
    hold on;
    file_sizes = [results.OrigSize];
    ratios = [results.Ratio];
    model_names = {results.Model};
    
    colors = lines(length(models));
    for m = 1:length(models)
        idx = strcmp(model_names, models{m});
        scatter(file_sizes(idx), ratios(idx), 50, colors(m,:), 'filled', 'DisplayName', models{m});
    end
    set(gca, 'XScale', 'log');
    title('File Size vs. Compression Ratio');
    xlabel('File Size (Bytes) [Log Scale]');
    ylabel('Compression Ratio');
    legend('Location', 'bestoutside');
    grid on;
    saveas(gcf, 'images/size_vs_ratio.png');
    fprintf('Saved images/size_vs_ratio.png\n');

    % Plot 5: File Size vs Encoding Time
    figure('Visible', 'off');
    hold on;
    times = [results.EncTime];
    for m = 1:length(models)
        idx = strcmp(model_names, models{m});
        scatter(file_sizes(idx), times(idx), 50, colors(m,:), 'filled', 'DisplayName', models{m});
    end
    set(gca, 'XScale', 'log', 'YScale', 'log');
    title('File Size vs. Encoding Time');
    xlabel('File Size (Bytes) [Log Scale]');
    ylabel('Encoding Time (s) [Log Scale]');
    legend('Location', 'bestoutside');
    grid on;
    saveas(gcf, 'images/size_vs_time.png');
    fprintf('Saved images/size_vs_time.png\n');
end
